# 图像人脸融合模板增加

更新时间：2023-08-29 13:44:24

[产品详情](https://vision.aliyun.com/)

[我的收藏](https://help.aliyun.com/my_favorites.html)



本文介绍人脸人体（facebody）类目下的图像人脸融合模板增加AddFaceImageTemplate的语法及示例。

## 功能描述

图像人脸融合模板增加功能可以将已通过内容审核的人脸图像，作为人脸融合的模板图，供图像人脸融合功能使用。

**说明**

- 您可以进入[在线咨询](https://www.aliyun.com/core/online-consult?from=aZgW6LJHr2)获取在线人工帮助。
- 阿里云视觉智能开放平台视觉AI能力API接入、接口使用或问题咨询等，请通过钉钉群（23109592）加入阿里云视觉智能开放平台咨询群联系我们。

## 接入指引

1. 注册阿里云账号：打开[阿里云官网](https://www.aliyun.com/)，在阿里云官网右上角，单击**立即注册**，按照操作提示完成账号注册。
2. 开通能力：请确保您已开通[人脸人体服务](https://vision.aliyun.com/facebody)，若未开通服务请[立即开通](https://common-buy.aliyun.com/?commodityCode=viapi_facebody_public_cn#/open)。

**重要**

本能力仅限企业认证用户开通。更多实名认证操作信息，请参见[实名认证](https://help.aliyun.com/document_detail/37170.html)。

3. 创建AccessKey：请确保您已[创建AccessKey](https://help.aliyun.com/zh/viapi/getting-started/create-the-accesskey)，如果您使用的是子账号AccessKey，您需要给子账号赋予AliyunVIAPIFullAccess权限，具体操作，请参见[RAM授权](https://help.aliyun.com/zh/viapi/developer-reference/use-ram-policy-access-control)。
4. 在线调试（可选）：您可以通过[OpenAPI Explorer](https://next.api.aliyun.com/api/facebody/2019-12-30/AddFaceImageTemplate?lang=JAVA&sdkStyle=old&params={}&tab=DEMO)在线调试能力，查看完整的调用示例代码及SDK依赖信息，也可以下载完整的工程。
5. 开发接入步骤：

- 在[SDK总览](https://help.aliyun.com/zh/viapi/developer-reference/the-sdk-overview)中选择您要接入使用的SDK语言。
- 在对应语言的SDK文档中找到AI类目为人脸人体（facebody）的SDK包进行安装。
- 参考文档中提供的示例代码进行适当修改后调用。
- 示例代码：该能力常用语言的示例代码，请参见[图像人脸融合模板增加示例代码](https://help.aliyun.com/zh/viapi/use-cases/human-face-image-fusion-template)。
- 客户端直接调用：该能力常用的客户端调用方式包括以下几种。

- [Web前端直接调用](https://help.aliyun.com/zh/viapi/developer-reference/web-front-end-direct-call)
- [小程序场景下直接调用](https://help.aliyun.com/zh/viapi/developer-reference/small-application-scenario-called-directly)
- [Android端直接调用](https://help.aliyun.com/zh/viapi/developer-reference/the-android-client-direct-call)
- [iOS端直接调用](https://help.aliyun.com/zh/viapi/developer-reference/the-ios-side-direct-call)

## 输入限制

- 图像格式：JPG、JPEG、PNG。
- 图像大小：不超过20 MB。
- 图像分辨率：大于等于128×128像素，小于等于2000×2000像素，最长边小于等于2000像素。
- URL地址中不能包含中文字符。
- 支持输入多人图像，建议图像中人脸个数不超过5个。
- 不限制可以增加的模板数量。

## 图像质量建议

- 要求保证图像中的人脸清晰。图像中人脸尺寸建议大于64×64像素，人脸区域建议不大于全图区域的2/3。
- 建议图像中人脸五官区域轮廓完整，无明显遮挡。人脸融合算法支持人脸偏侧一定角度，在偏侧角度不超过30度的情况下能取得更佳效果。

推荐图像示例：

![img](https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20221114/jris/MergeImageFacetuijian.png)

不推荐图像示例：

![img](https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20221114/rkbx/MergeImageFacebutuijian.png)

## 计费说明

图像人脸融合模板增加能力可免费调用。

## 调试

[您可以在OpenAPI Explorer中直接运行该接口，免去您计算签名的困扰。运行成功后，OpenAPI Explorer可以自动生成SDK代码示例。](https://api.aliyun.com/#product=facebody&api=AddFaceImageTemplate&type=RPC&version=2019-12-30)

![img](https://img.alicdn.com/tfs/TB16JcyXHr1gK0jSZR0XXbP8XXa-24-26.png) 调试

## 请求参数

|      |      |      |      |      |
| ---- | ---- | ---- | ---- | ---- |
|      |      |      |      |      |

| **名称** | **类型** | **是否必选** | **示例值**                                                   | **描述**                                                     |
| -------- | -------- | ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Action   | String   | 是           | AddFaceImageTemplate                                         | 系统规定参数。取值：**AddFaceImageTemplate**。               |
| ImageURL | String   | 是           | https://invi-label.oss-cn-shanghai.aliyuncs.com/label/temp/faceswap/img_facefusion/template/sucai1.jpg | 人脸模板的图像地址。推荐使用上海地域的OSS链接，对于文件在本地或者非上海地域OSS链接的情况，请参见[文件URL处理](https://help.aliyun.com/zh/viapi/getting-started/the-file-url-processing)。输入限制：图像格式：JPG、JPEG、PNG。图像大小：不超过20 MB。图像分辨率：大于等于128×128像素，小于等于2000×2000像素，最长边小于等于2000像素。URL地址中不能包含中文字符。支持输入多人图像，建议图像中人脸个数不超过5个。 |

## 返回数据

|      |      |      |      |
| ---- | ---- | ---- | ---- |
|      |      |      |      |

| **名称**       | **类型**           | **示例值**                                    | **描述**                                                     |
| -------------- | ------------------ | --------------------------------------------- | ------------------------------------------------------------ |
| RequestId      | String             | 798A721D-7C7F-4D87-A125-1D04B3055C2C          | 请求ID。                                                     |
| Data           | Object             |                                               | 返回的结果数据内容。                                         |
| TemplateId     | String             | 6cd509ea-54fa-4730-8e9d-c94cadcda048          | 模板ID。                                                     |
| FaceInfos      | Array of FaceInfos |                                               | 用户输入图为多个人脸时，返回各人脸ID和位置信息。**说明**只有在多人脸场景中，才会返回**FaceInfos**参数。 |
| TemplateFaceID | String             | string 6cd509ea-54fa-4730-8e9d-c94cadcda048_0 | 人脸对应的子模板ID。                                         |
| FaceRect       | Object             |                                               | 人脸对应的位置信息。                                         |
| X              | String             | 254                                           | 人脸框左上角横坐标。                                         |
| Y              | String             | 318                                           | 人脸框左上角纵坐标。                                         |
| Height         | String             | 94                                            | 人脸框高度。                                                 |
| Width          | String             | 89                                            | 人脸框宽度。                                                 |

## SDK参考

阿里云视觉AI人脸人体类目下的图像人脸融合模板增加能力推荐使用SDK调用，支持多种编程语言，调用时请选择AI类目为人脸人体（facebody）的SDK包，文件参数通过SDK调用可支持本地文件及任意URL，具体可参见[SDK总览](https://help.aliyun.com/zh/viapi/developer-reference/the-sdk-overview)。

## 示例代码

该能力常用语言的示例代码，请参见[图像人脸融合模板增加示例代码](https://help.aliyun.com/zh/viapi/use-cases/human-face-image-fusion-template)。

## 示例

请求示例

 

```awk
http(s)://facebody.cn-shanghai.aliyuncs.com/?Action=AddFaceImageTemplate   //更多关于访问域名（Endpoint）信息，请参见：https://help.aliyun.com/document_detail/143103.html
&ImageURL=https://invi-label.oss-cn-shanghai.aliyuncs.com/label/temp/faceswap/img_facefusion/template/sucai1.jpg
&公共请求参数
```

请求示例补充说明

 

```awk
//当输入的人脸模板为多人脸场景时，请求示例如下：
http(s)://facebody.cn-shanghai.aliyuncs.com/?Action=AddFaceImageTemplate   //更多关于访问域名（Endpoint）信息，请参见：https://help.aliyun.com/document_detail/143103.html
&ImageURL=http://viapi-test.oss-cn-shanghai.aliyuncs.com/viapi-3.0domepic/facebody/DetectPedestrian/DetectPedestrian8.jpg
&公共请求参数
```

正常返回示例

`XML`格式

 

```apache
HTTP/1.1 200 OK
Content-Type:application/xml

<AddFaceImageTemplateResponse>
    <RequestId>7BC58484-6724-508F-857D-0E7035AD5DEA</RequestId>
    <Data>
        <TemplateId>30f738a9-1e69-4ecb-8bbc-50bf0aa75e60</TemplateId>
    </Data>
</AddFaceImageTemplateResponse>
```

`JSON`格式

 

```ruby
HTTP/1.1 200 OK
Content-Type:application/json

{
  "RequestId" : "7BC58484-6724-508F-857D-0E7035AD5DEA",
  "Data" : {
    "TemplateId" : "30f738a9-1e69-4ecb-8bbc-50bf0aa75e60"
  }
}
```

返回示例补充说明

 

```json
//当输入的人脸模板为多人脸场景时，返回示例如下：
{
  "RequestId": "0AE75311-21D6-5E7A-AF6D-70956E67ED89",
  "Data": {
    "FaceInfos": [
      {
        "FaceRect": {
          "X": "421.4748",
          "Y": "91.21092",
          "Height": "109.89087",
          "Width": "102.43414"
        },
        "TemplateFaceID": "b44fe21c-5c81-41f3-93c5-8177b895b7cf_0"
      },
      {
        "FaceRect": {
          "X": "181.38963",
          "Y": "139.80676",
          "Height": "98.78714",
          "Width": "97.7758"
        },
        "TemplateFaceID": "b44fe21c-5c81-41f3-93c5-8177b895b7cf_1"
      },
      {
        "FaceRect": {
          "X": "655.54626",
          "Y": "144.6498",
          "Height": "94.08194",
          "Width": "99.913025"
        },
        "TemplateFaceID": "b44fe21c-5c81-41f3-93c5-8177b895b7cf_2"
      }
    ],
    "TemplateId": "b44fe21c-5c81-41f3-93c5-8177b895b7cf"
  }
}
```

## 错误码

关于图像人脸融合模板增加的错误码，详情请参见[常见错误码](https://help.aliyun.com/zh/viapi/developer-reference/common-error-code-13)。