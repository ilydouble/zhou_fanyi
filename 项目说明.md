# LivePortrait 视频生成器项目说明

## 项目概述

这个项目实现了基于阿里云LivePortrait API的自动化视频生成系统，能够：

1. **自动检测图像质量** - 使用 `liveportrait-detect` 模型验证图片是否符合要求
2. **批量生成视频** - 对通过检测的图片使用 `liveportrait` 模型生成人像动态视频
3. **完整的工作流程** - 从图片检测到视频下载的全自动化流程

## 核心功能

### 1. 图像质量检测
- 检测人脸是否清晰可见
- 验证图片格式和尺寸
- 确保符合LivePortrait模型要求

### 2. 视频生成
- 使用指定音频文件（qiezi.wav）
- 可配置的视频参数（帧率、动作幅度等）
- 异步任务处理和状态监控

### 3. 文件管理
- 自动创建输出目录
- 规范的文件命名
- 本地HTTP服务器提供文件访问

## 文件结构

```
├── video_generator.py      # 主程序
├── file_server.py         # HTTP文件服务器
├── config.py             # 配置文件
├── test_setup.py         # 环境测试脚本
├── demo.py               # 演示脚本
├── requirements.txt      # 依赖包列表
├── .env                  # API密钥配置
├── README.md             # 使用说明
├── pics/                 # 输入图片目录
├── sound/                # 音频文件目录
│   └── qiezi.wav        # 指定音频文件
├── videos/               # 输出视频目录
└── docs/                 # API文档
    ├── LivePortrait图像检测API参考.md
    └── LivePortrait 视频生成API参考.md
```

## 技术特点

### 1. 模块化设计
- 清晰的类结构和方法分离
- 可配置的参数系统
- 易于扩展和维护

### 2. 错误处理
- 完整的异常捕获和处理
- 详细的日志记录
- 用户友好的错误信息

### 3. 异步任务管理
- 任务状态实时监控
- 超时处理机制
- 自动重试逻辑

### 4. 文件服务
- 阿里云OSS对象存储
- 自动文件上传
- 公网URL生成
- 自动资源清理

## 配置选项

### 视频生成参数
- `template_id`: 动作模板（normal/calm/active）
- `eye_move_freq`: 眨眼频率（0-1）
- `video_fps`: 视频帧率（15-30）
- `mouth_move_strength`: 嘴部动作幅度（0-1.5）
- `paste_back`: 是否贴回原图
- `head_move_strength`: 头部动作幅度（0-1）

### 系统配置
- 文件路径设置
- 服务器端口配置
- 任务超时设置
- 日志级别配置

## 使用流程

1. **环境准备**
   - 安装Python依赖
   - 配置API密钥
   - 准备输入文件

2. **质量检测**
   - 自动检测所有图片
   - 过滤不符合要求的图片
   - 记录检测结果

3. **视频生成**
   - 提交异步任务
   - 监控任务状态
   - 下载生成结果

4. **结果输出**
   - 保存到指定目录
   - 生成处理报告
   - 清理临时资源

## 注意事项

### API限制
- 图片大小 < 10MB
- 音频大小 < 15MB
- 音频时长 1-300秒
- 需要稳定的网络连接

### 性能考虑
- 视频生成需要较长时间
- 建议分批处理大量图片
- 监控API使用配额

### 安全性
- API密钥安全存储
- 本地服务器仅限本地访问
- 及时清理临时文件

## 扩展可能

1. **批处理优化** - 支持并行处理多个任务
2. **云存储集成** - 支持云端文件存储
3. **Web界面** - 提供图形化操作界面
4. **结果分析** - 添加视频质量评估
5. **模板管理** - 支持自定义动作模板

## 故障排除

### 常见问题
1. **API密钥错误** - 检查.env文件配置
2. **网络连接失败** - 确认网络连接和防火墙设置
3. **文件格式不支持** - 检查图片和音频格式
4. **任务超时** - 调整超时设置或检查网络状况

### 调试方法
1. 运行 `test_setup.py` 检查环境
2. 查看详细日志信息
3. 使用演示模式测试功能
4. 检查API文档了解限制

这个项目提供了一个完整、可靠的LivePortrait视频生成解决方案，适合批量处理人像图片生成动态视频的需求。
